(function(){var m=false;var a=function a(){if(m){return false}if(!document.createElement("canvas").getContext){m=true;if(typeof console!=="undefined"){console.log("Notificon: requires canvas support")}return false}return true};var k=function k(n){if(!n){n={}}var p={font:"10px monospace",color:"#000000",stroke:"rgba(255,255,255,0.85)",align:"right",valign:"bottom",width:4,favicon:j()};for(var o in p){if(!n[o]){n[o]=p[o]}}return n};var l=function l(p){var o=document.getElementsByTagName("link");for(var n=0;n<o.length;n++){if(p&&(/\bnotificon\b/i).test(o[n].getAttribute("rel"))){return o[n]}else{if(!p&&(/\bicon\b/i).test(o[n].getAttribute("rel"))){return o[n]}}}return false};var j=function j(){var n=l();return n?n.getAttribute("href"):"/favicon.ico"};var e=function e(){var n=l(true);if(n){n.parentNode.removeChild(n);e()}};var f=function f(o){var n=document.createElement("link");n.type="image/x-icon";n.rel="icon notificon";n.href=o;e();document.getElementsByTagName("head")[0].appendChild(n)};var d=function d(n){return{x:n.align.toLowerCase()==="left"?0:16,y:n.valign.toLowerCase()==="top"?0:18}};var h=function h(p,o,n){var q=p.getContext("2d");var r=d(n);q.font=n.font;q.fillStyle=n.color;q.textAlign=n.align;q.textBaseline=n.valign;q.strokeStyle=n.stroke;q.lineWidth=n.width;q.strokeText(o,r.x,r.y);q.fillText(o,r.x,r.y)};var c=function c(n){var o=document.createElement("canvas");o.width=n.width;o.height=n.height;var p=o.getContext("2d");p.drawImage(n,0,0);return o};var b=function b(q,n){if(!a()){return false}var p=k(n);q=""+q;if(!q.length){return f(p.favicon)}var o=document.createElement("img");o.src=p.favicon;o.crossOrigin="anonymous";o.onload=function(){var r=c(o);if(q){h(r,q,p)}try{return f(r.toDataURL("image/png"))}catch(s){if(typeof console!=="undefined"){console.log("Notificon: cannot use icons located on a different domain ("+favicon+")");return false}}};o.onerror=function(){if(typeof console!=="undefined"){console.log("Notificon: image not found ("+p.favicon+")");return false}};return true};var i=function(o,n){b(o,n)};i.reset=function g(){e()};if(typeof exports!=="undefined"){module.exports=i}else{this.Notificon=i}})(this);(function(e,b){var d=null,c=false,a=_.throttle(function(){var f=e(b).scrollTop()>d;if(f!==c){e("body").toggleClass("fixed",f);c=f}},30);STUDIP.HeaderMagic={enable:function(){e(b).bind("scroll.studip",a).trigger("scroll.studip")},disable:function(){e(b).unbind("scroll.studip");e("body").removeClass("fixed")}};e(b).ready(function(){if(e("#barBottomContainer").length>0){d=e("#barBottomContainer").offset().top;STUDIP.HeaderMagic.enable()}})}(jQuery,window.document));(function(e){var a={},d,b,c=false;var f=function(g){var h=e("<ul/>"),j=false,i={};e.each(g,function(k,l){h.append(l.html);var m=e(".notification:last",h).data().id;i[m]=l;if(l.html_id){e("#"+l.html_id).bind("mouseenter",STUDIP.PersonalNotifications.isVisited)}j=(j||!(m in a))});if(j||_.values(a).length!==_.values(i).length){a=i;e("#notification_list > ul").replaceWith(h)}STUDIP.PersonalNotifications.update()};STUDIP.PersonalNotifications={newNotifications:function(){},markAsRead:function(g){var h=e(this).closest(".notification"),i=h.data().id;STUDIP.PersonalNotifications.sendReadInfo(i,h);return false},sendReadInfo:function(h,g){e.ajax({url:STUDIP.ABSOLUTE_URI_STUDIP+"dispatch.php/jsupdater/mark_notification_read/"+h,success:function(){if(g){g.toggle("blind","fast",function(){delete a[h];STUDIP.PersonalNotifications.update();e(this).remove()})}}})},update:function(){var i=_.values(a).length,g=parseInt(e("#notification_marker").text(),10),h=0;e("#notification_list > ul > li").each(function(){if(parseInt(e(this).attr("data-timestamp"),10)>parseInt(e("#notification_marker").attr("data-lastvisit"))){h++}});if(h>0){e("#notification_marker").data("seen",false).addClass("alert");window.document.title="(!) "+d}else{e("#notification_marker").removeClass("alert");window.document.title=d}if(i){e("#notification_container").addClass("hoverable");if(i>g&&c!==false){c.play()}}else{e("#notification_container").removeClass("hoverable")}if(g!==i){e("#notification_marker").text(i)}Notificon(i||"",{favicon:b})},isVisited:function(){var g=this.id;e.each(a,function(h,i){if(i.html_id===g){STUDIP.PersonalNotifications.sendReadInfo(i.personal_notification_id)}})},setSeen:function(){if(e("#notification_marker").data("seen")){return}e("#notification_marker").data("seen",true);e.ajax({url:STUDIP.ABSOLUTE_URI_STUDIP+"dispatch.php/jsupdater/notifications_seen",success:function(g){e("#notification_marker").removeClass("alert").attr("data-lastvisit",g)}})}};e("#notification_list .mark_as_read").live("click",STUDIP.PersonalNotifications.markAsRead);e("#notification_list").live("mouseenter",STUDIP.PersonalNotifications.setSeen);e(document).ready(function(){if(e("#notification_marker").length>0){d=window.document.title;b=e('link[rel="shortcut icon"]').attr("href");STUDIP.PersonalNotifications.newNotifications=f;if(e("#audio_notification").length>0){c=e("#audio_notification").get(0);c.load()}}})}(jQuery));
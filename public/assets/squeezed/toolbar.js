(function(a){STUDIP.Toolbar={buttonSet:{},initialize:function(f,c){var d=a(f),h=d.css("width")||d.width(),g,i,e,b;if(!d.is("textarea")||d.data("toolbar-added")){return}c=c||STUDIP.Toolbar.buttonSet;d.data("toolbar-added",true);i=a('<div class="buttons" />');_.each(["left","right"],function(j){var k=a("<span/>").addClass(j);_.each(c[j],function(o,m){var n=a("<span />").addClass(m),l=o.label||m;if(o.icon){l=a("<img/>").attr("alt",o.label||m).attr("src",STUDIP.ASSETS_URL+"images/icons/16/blue/"+o.icon+".png")}n.html(l).button().click(function(){var r=d.getSelection(),p=o.evaluate(r,d,this)||r,q=_.isObject(p)?p.replacement:(_.isUndefined(p)?r:p),s=_.isObject(p)?p.offset:(p||"").length;d.replaceSelection(q,s);return false});k.append(n)});i.append(k)});e=a('<div class="editor_toolbar" style="position: absolute; left: -999px; top: -999px;"/>').css("width",h).html(i.clone().css("position","relative")).appendTo("body");b=e.height();e.remove();g=a('<div class="editor_toolbar"/>').css("width",h);d.css("width","100%").wrap(g).before(i).css("margin-top","+="+b)}};a.fn.extend({addToolbar:function(b){return this.each(function(){STUDIP.Toolbar.initialize(this,b)})},getSelection:function(){var b=this[0];if(!!document.selection){return document.selection.createRange().text}if(!!this[0].setSelectionRange){return this[0].value.substring(this[0].selectionStart,this[0].selectionEnd)}return false},replaceSelection:function(b,c){return this.each(function(){var e=this.scrollTop,d,f;if(!!document.selection){this.focus();d=document.selection.createRange();d.text=b;d.select()}else{if(!!this.setSelectionRange){f=this.selectionStart;this.value=this.value.substring(0,f)+b+this.value.substring(this.selectionEnd);this.setSelectionRange(f+(c||b.length),f+(c||b.length))}}this.focus();this.scrollTop=e})}})}(jQuery));(function(b){function a(c,d){if(d===undefined){d=c}return function(e){if(e.substr(0,c.length)===c&&e.substr(-d.length)===d){return e}if(e){return c+e+d}return{replacement:c+d,offset:c.length}}}STUDIP.Toolbar.buttonSet={left:{bold:{label:"<strong>B</strong>",evaluate:a("**")},italic:{label:"<em>i</em>",evaluate:a("%%")},underline:{label:"<u>u</u>",evaluate:a("__")},strikethrough:{label:"<del>u</del>",evaluate:a("{-","-}")},code:{label:"<code>code</code>",evaluate:a("[code]","[/code]")},larger:{label:"A+",evaluate:a("++")},smaller:{label:"A-",evaluate:a("--")},signature:{label:"signature",evaluate:a("","\u2013~~~")},link:{label:"link",evaluate:function(d){d=d||window.prompt("Text:")||"";if(d.length===0){return d}var c=window.prompt("URL:")||"";return c.length===0?d:"["+d+"]"+c}},image:{label:"img",evaluate:function(d){var c=window.prompt("URL:")||"";return c.length===0?d:"[img="+d+"]"+c}}},right:{smilies:{label:":)",evaluate:function(d,c,e){STUDIP.SmileyPicker.toggle(e,function(f){c.replaceSelection(f+" ")})}},help:{label:"?",evaluate:function(){var c=b("link[rel=help].text-format").attr("href");window.open(c,"_blank")}}}}}(jQuery));(function(d){var e=false,b=d("<div/>"),a=function(){};function c(f,g){d.get(f,function(h){h=d(h);d(".smileys img",h).each(function(){var i=this,k=this.src,j=new Image();this.src=STUDIP.ASSETS_URL+"images/ajax_indicator_small.gif";j.onload=j.onerror=function(){i.src=k};j.src=k});b.html(h);if(d.isFunction(g)){g()}})}STUDIP.SmileyPicker={show:function(g,f){a=f;if(!e){b.dialog({autoOpen:false,width:420,dialogClass:"smiley-picker-dialog",resizable:false,title:"Smileys".toLocaleString(),show:"fade",hide:"fade",buttons:[{text:"Zur Gesamt√ºbersicht".toLocaleString(),click:function(){window.open(STUDIP.URLHelper.getURL("dispatch.php/smileys"),"_blank");b.dialog("close")}},{text:"Schliessen".toLocaleString(),click:function(){b.dialog("close")}}]});d(g).showAjaxNotification();c(STUDIP.URLHelper.getURL("dispatch.php/smileys/picker"),function(){d(g).hideAjaxNotification();b.dialog("open")});e=true}else{b.dialog("open")}},hide:function(){b.dialog("close")},toggle:function(g,f){if(e&&b.dialog("isOpen")){STUDIP.SmileyPicker.hide()}else{STUDIP.SmileyPicker.show(g,f)}}};d(".smiley-picker .navigation a").live("click",function(){c(this.href);return false});d(".smiley-picker .smiley").live("click",function(){a(d(this).data().code);b.dialog("close");return false})}(jQuery));